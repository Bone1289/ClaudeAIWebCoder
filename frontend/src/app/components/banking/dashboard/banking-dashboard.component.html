<div class="banking-dashboard">
  <div class="dashboard-header">
    <h1>Bank Account Management</h1>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openAddModal()">
        + Add Account
      </button>
      <button class="btn btn-secondary" (click)="loadAccounts()">
        <span>&#x21bb;</span> Refresh
      </button>
    </div>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="success-message">
    <span class="success-icon">‚úì</span>
    <p>{{ successMessage }}</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !showAddModal && !showEditModal && !showDeleteModal" class="error-message">
    <span class="error-icon">‚ö†</span>
    <p>{{ error }}</p>
    <button class="btn btn-secondary" (click)="loadAccounts()">Try Again</button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card">
        <div class="card-icon">üí∞</div>
        <div class="card-content">
          <h3>Total Balance</h3>
          <p class="amount">${{ getTotalBalance().toFixed(2) }}</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="card-icon">üè¶</div>
        <div class="card-content">
          <h3>Active Accounts</h3>
          <p class="count">{{ getActiveAccountsCount() }}</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="card-icon">üìä</div>
        <div class="card-content">
          <h3>Total Accounts</h3>
          <p class="count">{{ accounts.length }}</p>
        </div>
      </div>
    </div>

    <!-- Accounts Grid -->
    <div class="accounts-section">
      <h2>Your Accounts</h2>
      <div class="accounts-grid">
        <div *ngFor="let account of accounts"
             class="account-card"
             [class.selected]="selectedAccount?.id === account.id">
          <div class="account-header">
            <h3>{{ account.accountType }}</h3>
            <span class="account-status" [class]="'status-' + account.status.toLowerCase()">
              {{ account.status }}
            </span>
          </div>
          <div class="account-details">
            <p class="account-number">{{ account.accountNumber }}</p>
            <p class="account-balance">${{ account.balance.toFixed(2) }}</p>
            <p class="account-customer">{{ account.firstName }} {{ account.lastName }} <span class="nationality-badge">{{ getCountryFlag(account.nationality) }} {{ account.nationality }}</span></p>
          </div>
          <div class="account-actions">
            <a [routerLink]="['/banking/transactions', account.id]" class="btn btn-small">
              Transactions
            </a>
            <a [routerLink]="['/banking/statement', account.id]" class="btn btn-small">
              Statement
            </a>
            <a [routerLink]="['/banking/reports', account.id]" class="btn btn-small">
              Reports
            </a>
          </div>
          <div class="account-management">
            <button class="btn btn-edit" (click)="openEditModal(account)">
              ‚úèÔ∏è Edit
            </button>
            <button class="btn btn-delete" (click)="openDeleteModal(account)">
              üóëÔ∏è Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="accounts.length === 0" class="empty-state">
      <p>No accounts found. Create your first account to get started!</p>
      <button class="btn btn-primary" (click)="openAddModal()">+ Add Account</button>
    </div>
  </div>

  <!-- Add Account Modal -->
  <div *ngIf="showAddModal" class="modal-overlay" (click)="closeAddModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add New Account</h2>
        <button class="close-btn" (click)="closeAddModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="firstName">First Name:</label>
          <input type="text" id="firstName" [(ngModel)]="newAccount.firstName" class="form-control" placeholder="Enter first name" required>
        </div>
        <div class="form-group">
          <label for="lastName">Last Name:</label>
          <input type="text" id="lastName" [(ngModel)]="newAccount.lastName" class="form-control" placeholder="Enter last name" required>
        </div>
        <div class="form-group nationality-autocomplete">
          <label for="nationality">Nationality:</label>
          <div class="autocomplete-container">
            <input
              type="text"
              id="nationality"
              [(ngModel)]="newAccount.nationality"
              (input)="onNationalityInput($event)"
              (focus)="onNationalityFocus()"
              (blur)="hideCountryDropdown()"
              class="form-control"
              placeholder="Type to search countries..."
              autocomplete="off"
              required>
            <div *ngIf="showCountryDropdown" class="autocomplete-dropdown">
              <div
                *ngFor="let country of filteredCountries"
                class="autocomplete-item"
                (mousedown)="selectCountry(country)">
                <span class="country-flag">{{ country.flag }}</span>
                <span class="country-name">{{ country.name }}</span>
              </div>
              <div *ngIf="filteredCountries.length === 0" class="autocomplete-no-results">
                No countries found
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="accountType">Account Type:</label>
          <select id="accountType" [(ngModel)]="newAccount.accountType" class="form-control">
            <option *ngFor="let type of accountTypes" [value]="type">{{ type }}</option>
          </select>
        </div>
        <div *ngIf="error" class="error-message-inline">
          {{ error }}
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
        <button class="btn btn-primary" (click)="createAccount()" [disabled]="loading">
          {{ loading ? 'Creating...' : 'Create Account' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Account Modal -->
  <div *ngIf="showEditModal" class="modal-overlay" (click)="closeEditModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Edit Account</h2>
        <button class="close-btn" (click)="closeEditModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Account Number:</label>
          <p class="readonly-field">{{ editingAccount?.accountNumber }}</p>
        </div>
        <div class="form-group">
          <label>Current Balance:</label>
          <p class="readonly-field">${{ (editingAccount?.balance || 0).toFixed(2) }}</p>
        </div>
        <div class="form-group">
          <label for="editAccountType">Account Type:</label>
          <select id="editAccountType" [(ngModel)]="editAccountType" class="form-control">
            <option *ngFor="let type of accountTypes" [value]="type">{{ type }}</option>
          </select>
        </div>
        <div *ngIf="error" class="error-message-inline">
          {{ error }}
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
        <button class="btn btn-primary" (click)="updateAccount()" [disabled]="loading">
          {{ loading ? 'Updating...' : 'Update Account' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Account Modal -->
  <div *ngIf="showDeleteModal" class="modal-overlay" (click)="closeDeleteModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Delete Account</h2>
        <button class="close-btn" (click)="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p class="warning-text">Are you sure you want to delete this account?</p>
        <div class="account-summary">
          <p><strong>Account Number:</strong> {{ accountToDelete?.accountNumber }}</p>
          <p><strong>Account Type:</strong> {{ accountToDelete?.accountType }}</p>
          <p><strong>Balance:</strong> ${{ (accountToDelete?.balance || 0).toFixed(2) }}</p>
        </div>
        <p class="info-text">Note: You can only delete accounts with zero balance.</p>
        <div *ngIf="error" class="error-message-inline">
          {{ error }}
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button class="btn btn-danger" (click)="deleteAccount()" [disabled]="loading">
          {{ loading ? 'Deleting...' : 'Delete Account' }}
        </button>
      </div>
    </div>
  </div>
</div>
