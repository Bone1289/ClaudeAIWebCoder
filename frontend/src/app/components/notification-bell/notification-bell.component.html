<div class="notification-bell-container">
  <!-- Bell Icon Button -->
  <button
    class="notification-bell-btn"
    (click)="toggleDropdown()"
    [class.has-notifications]="unreadCount > 0"
    title="Notifications">
    <svg xmlns="http://www.w3.org/2000/svg" class="bell-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
    </svg>
    <span *ngIf="unreadCount > 0" class="notification-badge">
      {{ unreadCount > 99 ? '99+' : unreadCount }}
    </span>
  </button>

  <!-- Dropdown Panel -->
  <div *ngIf="isOpen" class="notification-dropdown">
    <div class="dropdown-header">
      <h3>Notifications</h3>
      <div class="header-actions">
        <button
          *ngIf="notifications.length > 0"
          (click)="markAllAsRead()"
          class="mark-all-btn"
          title="Mark all as read">
          ✓ Mark all read
        </button>
        <button (click)="closeDropdown()" class="close-btn" title="Close">×</button>
      </div>
    </div>

    <div class="dropdown-body">
      <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Loading notifications...</p>
      </div>

      <div *ngIf="!loading && notifications.length === 0" class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" class="empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
        </svg>
        <p>No new notifications</p>
        <span>You're all caught up!</span>
      </div>

      <div *ngIf="!loading && notifications.length > 0" class="notifications-list">
        <div
          *ngFor="let notification of notifications"
          class="notification-item"
          [class.unread]="!notification.read"
          (click)="markAsRead(notification, $event)">

          <div class="notification-icon">{{ getTypeIcon(notification.type) }}</div>

          <div class="notification-content">
            <div class="notification-header">
              <h4 class="notification-title">{{ notification.title }}</h4>
              <span class="notification-time">{{ getTimeAgo(notification.createdAt) }}</span>
            </div>
            <p class="notification-message">{{ notification.message }}</p>
            <div class="notification-meta">
              <span class="priority-badge" [ngClass]="getPriorityColor(notification.priority)">
                {{ notification.priority }}
              </span>
            </div>
          </div>

          <button
            (click)="deleteNotification(notification, $event)"
            class="delete-btn"
            title="Delete notification">
            ×
          </button>
        </div>
      </div>
    </div>

    <div class="dropdown-footer">
      <button (click)="viewAllNotifications()" class="view-all-btn">
        View All Notifications
      </button>
    </div>
  </div>

  <!-- Overlay to close dropdown when clicking outside -->
  <div *ngIf="isOpen" class="dropdown-overlay" (click)="closeDropdown()"></div>
</div>
